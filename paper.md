---
title: 'BlackBIRDS: Black-box Inference foR Differentiable Simulators'
tags:
  - Python
  - Bayesian inference
  - differentiable simulators
  - variational inference
  - Markov chain Monte Carlo
authors:
  - name: Arnau Quera-Bofarull
    orcid: 
    equal-contrib: true
    corresponding: true # (This is how to denote the corresponding author)
    affiliation: 1 # (Multiple affiliations must be quoted)
  - name: Joel Dyer
    equal-contrib: true
    corresponding: true # (This is how to denote the corresponding author)
    affiliation: "1, 2"
  - name: Anisoara Calinescu
    affiliation: 1
  - name: Michael Wooldridge
    affiliation: 1
affiliations:
 - name: Department of Computer Science, University of Oxford
   index: 1
 - name: Institute for New Economic Thinking, Oxford
   index: 2
date: 14 July 2023
bibliography: paper.bib

# Optional fields if submitting to a AAS journal too, see this blog post:
# https://blog.joss.theoj.org/2018/12/a-new-collaboration-with-aas-publishing
aas-doi: 10.3847/xxxxx <- update this with the DOI from AAS once you know it.
aas-journal: Astrophysical Journal <- The name of the AAS journal.
---

# Summary

`blackbirds` is a Python package consisting of generically applicable, black-box
inference methods for differentiable simulation models. It facilitates both (a) 
the differentiable implementation of simulation models by providing a common 
object-oriented framework for their implementation in `pytorch` [@pytorch](`pytorch`), 
and (b) the use of a variety of inference procedures for these simulation models, 
allowing researchers to easily exploit the differentiable nature of their simulator in 
parameter estimation tasks. The package consists of both Bayesian and non-Bayesian
inference methods, and relies on well-supported software libraries (e.g. 
[@nflows](`nflows`)) to provide this broad functionality.

# Statement of need

Across scientific disciplines and application domains, simulation models are
used extensively as a means to studying complex mathematical models of real-world
systems. A simulation-based approach to modelling such systems provides the
modeller with significant benefits, permitting them to specify their model in the
way that they believe most faithfully represents the true data-generating
process and relieving them from the concerns regarding the mathematical tractability
of the resulting model. However, this additional flexibility comes at a price:
the resulting simulation model can be too complex to easily perform optimisation and
inference tasks on the simulator, which in many cases necessitates the use of
approximate, simulation-based inference and optimisation methods to perform these
tasks inexactly.

The complicated and black-box nature of many simulation models can present a
significant barrier to the successful deployment of these simulation-based inference 
and optimisation techniques. Consequently, there has been increasing interest within
various scientific communities in constructing *differentiable* simulation models: 
simulation models for which the gradient of the model output with respect to the
model's input parameters can be easily obtained. The primary motivation for this is
that access to this additional information, which captures the sensitivity of the
output of the simulator to changes in the input, can enable the use of more efficient 
optimisation and inference procedures, helping to reduce the total runtime of such 
algorithms, their overall consumption of valuable computational resources, and their 
concomitant financial and environmental costs.

To this end, `blackbirds` was designed to provide researchers with easy access to a
set of parameter inference methods that exploit the gradient information provided by
differentiable simulators. The package provides support for a variety of approaches to
gradient-assisted parameter inference, including:

- Simulated Minimum Distance (SMD, see e.g. [@smd](`ii` and `smm`)), in which parameter
  point estimates $\hat{\boldsymbol{\theta}}$ are obtained as

  \begin{equation}
      \hat{\boldsymbol{\theta}} 
      = 
      \arg \min_{\boldsymbol{\theta} \in \boldsymbol{\Theta}} {
        f(\mathbf{y}, \boldsymbol{\theta})
      },
  \end{equation}
  where $\boldsymbol{\theta}$ are the simuolator's parameters, which take values in some
  set $\boldsymbol{\Theta}$, and $f$ is a loss function capturing the compatibility with
  the observed data $\mathbf{y}$ with the simulator's behaviour at parameter vector 
  $\mathbf{\theta}$;
- Markov chain Monte Carlo (MCMC), in which samples from a parameter posterior 
  $\pi(\boldsymbol{\theta} \mid \mathbf{y})$ are generated by executing a Markov chain on
  $\boldsymbol{\Theta}$. Currently, support is provided for Metropolis-adjusted Langevin
  Dynamics [@mala](`mala`), although nothing prevents the inclusion of additional 
  gradient-assisted MCMC algorithms such as Hmailtonian Monte Carlo [@hmc](`hmc`);
- Variational inference (VI), in which a (usually parameteric) approximation $q^*$ to the
  intractable posterior is obtained by solving the following optimisation problem over a
  variational family $\mathcal{Q}$:

  \begin{equation}
    q^* = \arg\min_{q \in \mathcal{Q}} {
        \mathcal{D}\left( q(\cdot) \Vert \pi(\cdot \mid \mathbf{y})\right) 
     }
  \end{equation}
  for some divergence $\mathcal{D}$ between probability density functions.


`Gala` was designed to be used by both astronomical researchers and by
students in courses on gravitational dynamics or astronomy. It has already been
used in a number of scientific publications [@Pearson:2017] and has also been
used in graduate courses on Galactic dynamics to, e.g., provide interactive
visualizations of textbook material [@Binney:2008]. The combination of speed,
design, and support for Astropy functionality in `Gala` will enable exciting
scientific explorations of forthcoming data releases from the *Gaia* mission
[@gaia] by students and experts alike.

You can also use plain \LaTeX for equations
\begin{equation}\label{eq:fourier}
\hat f(\omega) = \int_{-\infty}^{\infty} f(x) e^{i\omega x} dx
\end{equation}
and refer to \autoref{eq:fourier} from text.

# Citations

Citations to entries in paper.bib should be in
[rMarkdown](http://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html)
format.

If you want to cite a software repository URL (e.g. something on GitHub without a preferred
citation) then you can do it with the example BibTeX entry below for @fidgit.

For a quick reference, the following citation commands can be used:
- `@author:2001`  ->  "Author et al. (2001)"
- `[@author:2001]` -> "(Author et al., 2001)"
- `[@author1:2001; @author2:2001]` -> "(Author1 et al., 2001; Author2 et al., 2002)"

# Figures

Figures can be included like this:
![Caption for example figure.\label{fig:example}](figure.png)
and referenced from text using \autoref{fig:example}.

Figure sizes can be customized by adding an optional second parameter:
![Caption for example figure.](figure.png){ width=20% }

# Acknowledgements

This research was supported by a UKRI AI World Leading Researcher Fellowship awarded to Wooldridge (grant EP/W002949/1). 
M. Wooldridge and A. Calinescu acknowledge funding from Trustworthy AI - Integrating Learning, Optimisation and Reasoning 
(TAILOR) (https://tailor-network.eu/), a project funded by European Union Horizon2020 research and innovation program 
under Grant Agreement 952215.

# References
